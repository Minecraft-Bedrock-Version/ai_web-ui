[
    {
        "id": 1,
        "title": "sqs_flag_shop",
        "description": "document/sqs_flag_shop.json",
        "resources": [
  {
  "nodes": [
    {
      "node_type": "lambda_function",
      "node_id": "graph_node_id"
    },
    {
      "node_type": "lambda_event_source_mapping",
      "node_id": "graph_node_id",
      "attributes": {
        "state": "Enabled"
      },
      "relationships": {
        "source_arn": "sqs"
      }
    },
    {
      "node_type": "route_table",
      "node_id": "string",
      "attributes": {
        "type": "public"
      }
    },
    {
      "node_type": "internet_gateway",
      "node_id": "graph_node_id",
      "attributes": {
        "state": "available"
      }
    },
    {
      "node_type": "iam_role",
      "node_id": "string",
      "attributes": {
        "assume_role_policy": {
          "Statement": [
            {
              "Effect": "Allow",
              "Action": "sts:AssumeRole"
            }
          ]
        },
        "inline_policies": [
          {
            "Statement": [
              {
                "Action": ["sqs:GetQueueUrl", "sqs:SendMessage"],
                "Effect": "Allow"
              }
            ]
          }
        ]
      }
    },
    {
      "node_type": "ec2",
      "node_id": "string",
      "attributes": {
        "public": true,
        "sqs_info": {
          "detected": true
        },
        "rds_info": {
          "detected": true
        }
      }
    },
    {
      "node_type": "sqs",
      "node_id": "graph_node_id"
    },
    {
      "node_type": "iam_user",
      "node_id": "string",
      "attributes": {
        "inline_policies": [
          {
            "Statement": [
              {
                "Effect": "Allow",
                "Action": "sts:AssumeRole"
              }
            ]
          }
        ]
      }
    },
    {
      "node_type": "rds_instance",
      "node_id": "graph_node_id"
    },
    {
      "node_type": "subnet",
      "node_id": "string",
      "attributes": {
        "visibility": "public"
      }
    },
    {
      "node_type": "vpc",
      "node_id": "string"
    }
  ],
  "edges": [
    {
      "src": "ec2 node_id",
      "dst": "sqs node_id",
      "directed": true,
      "conditions": [
        { 
          "ec2" : {
            "attributes": {
              "sqs_info": { "detected": true }
            }
          } 
        }
      ]
    },
    {
      "src": "iam_user node_id",
      "dst": "iam_role node_id",
      "directed": false,
      "conditions": [
        {
          "iam_user": {
            "attributes": {
              "inline_policies": [
                {
                  "Statement": [
                    { "Effect": "Allow", "Action": "sts:AssumeRole" }
                  ]
                }
              ]
            }
          }
        }
      ]
    },
    {
      "src": "lambda_function node_id",
      "dst": "ec2 node_id",
      "directed": true,
      "conditions": [
        { "lambda_format_in_ec2_ip" : true }
      ]
    },
    {
      "src": "sqs node_id",
      "dst": "lambda_event_source_mapping node_id",
      "directed": true,
      "conditions": [
        {
          "lambda_event_source_mapping": {
            "relationships": { "source_arn": "sqs" }
          }
        }
      ]
    },
    {
      "src": "iam_role node_id",
      "dst": "sqs node_id",
      "directed": true,
      "conditions": [
        {
          "iam_role": {
            "attributes": {
              "assume_role_policy": {
                "inline_policies": [
                  {
                    "Statement": [
                      { "Action": ["sqs:GetQueueUrl", "sqs:SendMessage"], "Effect": "Allow" }
                    ]
                  }
                ],
                "attached_policies": [
                  {
                    "PolicyName": "AWSLambdaSQSQueueExecutionRole",
                    "PolicyArn": "arn:aws:iam::aws:policy/service-role/AWSLambdaSQSQueueExecutionRole"
                  }
                ]
              }
            }
          }
        }
      ]
    },
    {
      "src": "ec2 node_id",
      "dst": "igw node_id",
      "directed": false,
      "conditions": [
        {
          "ec2": {
            "attributes": { "public": true }
          }
        }
      ]
    },
    {
      "src": "ec2 node_id",
      "dst": "rds_instance node_id",
      "directed": false,
      "conditions": [
        { 
          "ec2" : {
            "attributes": {
              "rds_info": { "detected": true }
            }
          } 
        }
      ]
    }
  ]
}
]
},{
    "id": 2,
    "title": "lambda_privesc",
    "description": "document/lambda_privesc.json",
    "resources": [
      {
  "nodes": [
    {
      "node_type": "iam_role",
      "node_id": "string",
      "attributes": {
        "assume_role_policy": {
          "Statement": [
            {
              "Effect": "Allow",
              "Action": ["sts:AssumeRole"]
            }
          ]
        },
        "inline_policies": [],
        "attached_policies": [
          {
            "PolicyName": "AdministratorAccess",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": ["*"]
              }
            ]
          }
        ]
      }
    },
    {
      "node_type": "iam_role",
      "node_id": "string",
      "attributes": {
        "assume_role_policy": {
          "Statement": [
            {
              "Effect": "Allow",
              "Action": ["sts:AssumeRole"]
            }
          ]
        },
        "inline_policies": [],
        "attached_policies": [
          {
            "PolicyName": "string",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": ["lambda:*", "iam:PassRole"]
              }
            ]
          }
        ]
      }
    },
    {
      "node_type": "iam_user",
      "node_id": "string",
      "attributes": {
        "inline_policies": [],
        "attached_policies": [
          {
            "PolicyName": "string",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": ["sts:AssumeRole", "iam:List*", "iam:Get*"]
              }
            ]
          }
        ]
      }
    },
    {
      "node_type": "lambda_service",
      "node_id": "string"
    }
  ],
  "edges": [
    {
      "src": "iam_role node_id",
      "dst": "iam_role node_id",
      "directed": false,
      "conditions": [
        {
          "iam_role": {
            "attributes": {
              "attached_policies": [
                {
                  "Statement": [
                    {
                      "Effect": "Allow",
                      "Action": ["iam:PassRole"]
                    }
                  ]
                }
              ]
            }
          }
        }
      ]
    },
    {
      "src": "iam_role node_id",
      "dst": "lambda_service node_id",
      "directed": false,
      "conditions": [
        {
          "iam_role": {
            "attributes": {
              "assume_role_policy": [
                {
                  "Statement": [
                    {
                      "Effect": "Allow",
                      "Action": ["sts:AssumeRole"],
                      "Principal": {
                        "Service": "lambda.amazonaws.com"
                      }
                    }
                  ]
                }
              ]
            }
          }
        }
      ]
    },
    {
      "src": "iam_user node_id",
      "dst": "iam_role node_id",
      "directed": false,
      "conditions": [
        {
          "iam_user": {
            "attributes": {
              "attached_policies": [
                {
                  "Statement": [
                    {
                      "Effect": "Allow",
                      "Action": "sts:AssumeRole"
                    }
                  ]
                }
              ]
            }
          }
        }
      ]
    }
  ]
}
    ]
  },
  {
    "id": 3,
    "title": "더미3",
    "description": "더미경로3",
    "resources": [
      {
        "fileName": "rds.json",
        "content": {
          "nodes": [
            {
              "node_type": "rds_instance",
              "node_id": "db_node",
              "attributes": { "publicly_accessible": true, "storage_encrypted": true }
            }
          ]
        }
      },
      {
        "fileName": "security_group.json",
        "content": {
          "nodes": [
            {
              "node_type": "security_group",
              "node_id": "sg_open_3306",
              "attributes": { "ingress": [{ "from_port": 3306, "to_port": 3306, "cidr_blocks": ["0.0.0.0/0"] }] }
            }
          ]
        }
      }
    ]
  },
  {
    "id": 4,
    "title": "더미4",
    "description": "더미경로4",
    "resources": [
      {
        "fileName": "lambda.json",
        "content": {
          "nodes": [
            {
              "node_type": "lambda_function",
              "node_id": "worker_func",
              "attributes": { "runtime": "python3.9" }
            }
          ]
        }
      },
      {
        "fileName": "iam_role.json",
        "content": {
          "nodes": [
            {
              "node_type": "iam_role",
              "node_id": "admin_role",
              "attributes": {
                "attached_policies": [{ "PolicyArn": "arn:aws:iam::aws:policy/AdministratorAccess" }]
              }
            }
          ]
        }
      }
    ]
  },
  {
    "id": 5,
    "title": "더미5",
    "description": "더미경로5",
    "resources": [
      {
        "fileName": "ec2.json",
        "content": {
          "nodes": [
            {
              "node_type": "ec2",
              "node_id": "web_server",
              "attributes": {
                "http_tokens": "optional",
                "metadata_v2_enabled": false,
                "public": true
              }
            }
          ]
        }
      }
    ]
  }
]
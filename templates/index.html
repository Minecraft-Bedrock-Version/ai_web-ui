<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 기반의 인프라 및 자격 증명 변경 통제</title>
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <svg class="header-icon" fill="currentColor" viewBox="0 0 24 24">
            <!--<path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>-->
            <img src="../static/img/logo.webp" alt="logo" height="30" width="30" />
        </svg>
        <h1>Minecraft Bedrock Version</h1>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Progress Steps -->
        <div class="card">
            <div class="progress-container" id="progressSteps">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Content Area -->
        <div class="card content-area">
            <!-- Step 0: User Configuration -->
                        <!-- Step 0: User Configuration with Card-based Service Selection -->
            <div class="step-content-wrapper active" id="step-0">
                <h2 class="section-title">인프라 구성 설정</h2>
                <p class="section-description">새로 생성할 AWS 서비스와 액션을 선택해주세요.</p>

                <!-- Region Selector -->
                <div class="region-selector">
                    <label class="form-label" for="region">AWS 리전</label>
                    <select class="form-select" id="region">
                        <option value="">리전을 선택하세요</option>
                        <option value="us-east-1">US East (N. Virginia)</option>
                        <option value="us-west-2">US West (Oregon)</option>
                        <option value="ap-northeast-2">Asia Pacific (Seoul)</option>
                        <option value="ap-northeast-1">Asia Pacific (Tokyo)</option>
                        <option value="eu-west-1">Europe (Ireland)</option>
                    </select>
                </div>

                <!-- Selected Services Summary -->
                <div class="selected-services-summary" id="selectedSummary">
                    <div class="summary-title">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        선택된 서비스 및 액션
                    </div>
                    <div id="summaryContent"></div>
                </div>

                <!-- AWS Services Grid -->
                <div class="services-grid" id="servicesGrid">
                    <!-- Services populated by JavaScript -->
                </div>
            </div>
            <!-- <div class="step-content-wrapper active" id="step-0">
                <h2 class="section-title">인프라 구성 설정</h2>
                <p class="section-description">새로 생성할 인프라의 설정을 입력해주세요.</p>

                <div class="form-group">
                    <label class="form-label" for="region">AWS 리전</label>
                    <select class="form-select" id="region">
                        <option value="">리전을 선택하세요</option>
                        <option value="us-east-1">US East (N. Virginia)</option>
                        <option value="us-west-2">US West (Oregon)</option>
                        <option value="ap-northeast-2">Asia Pacific (Seoul)</option>
                        <option value="ap-northeast-1">Asia Pacific (Tokyo)</option>
                        <option value="eu-west-1">Europe (Ireland)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="infrastructureType">인프라 타입</label>
                    <select class="form-select" id="infrastructureType">
                        <option value="">인프라 타입을 선택하세요</option>
                        <option value="ec2">EC2 Instance</option>
                        <option value="lambda">Lambda Function</option>
                        <option value="rds">RDS Database</option>
                        <option value="s3">S3 Bucket</option>
                        <option value="ecs">ECS Container</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="description">인프라 설명</label>
                    <textarea class="form-textarea" id="description" rows="4" placeholder="생성하려는 인프라에 대한 설명을 입력하세요..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="iamCredentials">IAM 자격 증명 ARN</label>
                    <input class="form-input" type="text" id="iamCredentials" placeholder="arn:aws:iam::123456789012:user/username">
                    <p class="form-hint">사용자 A의 IAM 자격 증명을 입력하세요</p>
                </div>
            </div> -->

            <!-- Step 1: CLI Generation -->
            <!-- <div class="step-content-wrapper" id="step-1">
                <h2 class="section-title">AI 기반 CLI 생성</h2>
                <p class="section-description">AI가 입력된 설정을 기반으로 IAM 정책과 CLI 명령어를 생성합니다.</p>

                <div class="generate-container" id="generateContainer">
                    <div style="text-align: center;">
                        <p style="font-size: 18px; margin-bottom: 8px;">AI를 사용하여 보안 정책과 CLI 명령어를 자동 생성합니다</p>
                        <p class="form-hint">생성된 명령어는 검토 후 수정할 수 있습니다</p>
                    </div>
                    <button class="btn btn-primary btn-lg" onclick="generateCLI()" id="generateBtn">
                        CLI 생성하기
                    </button>
                </div>

                <div class="generated-content" id="generatedContent">
                    <div style="display: flex; align-items: center; gap: 8px; color: #16a34a; margin-bottom: 16px;">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <span style="font-weight: 500;">AI 생성 완료</span>
                    </div>

                    <div style="background: #F9FAFB; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h3 style="font-weight: 600;">생성된 IAM 정책 (JSON)</h3>
                            <span class="badge badge-secondary">AI 생성</span>
                        </div>
                        <pre class="code-block" id="generatedJSON"></pre>
                    </div>

                    <div style="background: #F9FAFB; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h3 style="font-weight: 600;">생성된 CLI 명령어</h3>
                            <span class="badge badge-secondary">AI 생성</span>
                        </div>
                        <pre class="code-block" id="generatedCLI"></pre>
                    </div>

                    <div style="text-align: right;">
                        <button class="btn btn-secondary" onclick="regenerateCLI()">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                            재생성
                        </button>
                    </div>
                </div>
                
            </div> -->

            <div class="step-content-wrapper" id="step-1">
    <h2 class="section-title">CLI 명령어 입력</h2>
    <p class="section-description">수행할 인프라 제어 명령어를 직접 입력해 주세요.</p>

    <div class="form-group" style="margin-top: 24px;">
        <label class="form-label" for="inputCLI">AWS CLI 명령어</label>
        <textarea 
            class="form-textarea code-block" 
            id="inputCLI" 
            rows="10" 
            placeholder="여기에 명령어를 입력하세요..."
            style="width: 100%; font-family: monospace; background: #1e293b; color: #f8fafc; padding: 15px; border-radius: 8px;"
        ></textarea>
    </div>

<div style="text-align: right; margin-top: 16px; display: flex; justify-content: flex-end; gap: 10px;">
    <button class="btn btn-secondary" id="resetCliBtn" onclick="resetCLI()">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 4px;">
            <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
        </svg>
        초기화
    </button>
    
    <button class="btn btn-primary" id="saveCliBtn" onclick="saveCLI()">
        명령어 저장
    </button>
</div>



</div>




            <!-- Step 2: Vulnerability Analysis -->
            <div class="step-content-wrapper" id="step-2">
                <h2 class="section-title">취약점 분석</h2>
                <p class="section-description">AI가 Attack Graph를 생성하여 잠재적 보안 위험을 분석합니다.</p>

                <div id="analysisIdle">
                    <div class="generate-container">
                        <svg width="64" height="64" fill="#FF9900" viewBox="0 0 24 24">
                            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-1 6h2v6h-2V7zm0 8h2v2h-2v-2z"/>
                        </svg>
                        <div style="text-align: center;">
                            <p style="font-size: 18px; font-weight: 500; margin-bottom: 8px;">취약점 분석 준비 완료</p>
                            <p style="font-size: 14px; color: #6B7280;">기존 인프라와 새 리소스 간의 공격 경로를 분석합니다</p>
                        </div>
                        <button class="btn btn-primary btn-lg" onclick="startAnalysis()" id="analysisBtn">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                            </svg>
                            분석 시작하기
                        </button>
                    </div>
                </div>

                <div id="analysisProgress" class="hidden">
                    <div class="card" style="padding: 24px; background: #F9FAFB;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <svg width="24" height="24" fill="#FF9900" viewBox="0 0 24 24" class="spinner">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" opacity="0.3"/>
                                <path d="M12 2v4c3.31 0 6 2.69 6 6h4c0-5.52-4.48-10-10-10z"/>
                            </svg>
                            <div>
                                <h3 style="font-weight: 600; margin-bottom: 4px;">Attack Graph 생성 중...</h3>
                                <p style="font-size: 14px; color: #6B7280;">기존 인프라와 새 리소스 간의 공격 경로를 분석하고 있습니다</p>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="analysisProgressBar" style="width: 0%"></div>
                        </div>
                        <p style="text-align: center; font-size: 13px; color: #6B7280; margin-top: 8px;" id="progressText">0% 완료</p>
                    </div>
                </div>

                <div id="analysisResults" class="hidden">
                    <div class="two-column-layout">
                        <!-- Left Column: Infrastructure Info -->
                        <div>
                            <div class="infrastructure-card">
                                <h3 class="infrastructure-title">현재 인프라 구성</h3>
                                <div class="json-viewer" id="infrastructureJSON"></div>
                            </div>
                        </div>

                        <!-- Right Column: Vulnerability Report -->
                        <div>
                            <div class="report-section">
                                <div class="report-header">
                                    <h2 class="report-title">보안 취약점 분석 보고서</h2>
                                    <p class="report-subtitle">Attack Graph 기반 위험 평가 및 권장사항</p>
                                </div>
                                <div class="report-body">
                                    <!-- Vulnerability List -->
                                    <div id="vulnerabilityList"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Execution -->
            <div class="step-content-wrapper" id="step-3">
                <h2 class="section-title">실행</h2>
                <p class="section-description">생성된 CLI 명령어를 실행하고 보안 모니터링을 진행합니다.</p>

                <div class="alert alert-info">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                    </svg>
                    <div>
                        <p><strong>보안 프로세스:</strong> 임시 IAM 자격 증명이 생성되고, AI가 생성했음을 로깅합니다. 
                        리소스 생성 후 CloudTrail 로그를 검증하여 비정상적인 활동을 탐지하고, 작업 완료 후 임시 자격 증명을 자동으로 삭제합니다.</p>
                    </div>
                </div>
<div id="executionIdle">
        <div class="generate-container">
            <div id="policyPreviewContainer" style="width: 100%; margin-bottom: 20px; display: none;">
                <p style="text-align: left; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                    ✨ AI가 분석한 최소 권한 정책 (JSON)
                </p>
                <pre id="policyPreviewJson" style="background: #1e293b; color: #f8fafc; padding: 15px; border-radius: 8px; text-align: left; font-size: 13px; max-height: 250px; overflow-y: auto; font-family: monospace;"></pre>
            </div>

            <div id="policyLoading" style="margin-bottom: 20px;">
                <div class="spinner" style="margin: 0 auto 10px;"></div>
                <p style="font-size: 14px; color: #6B7280;">AI가 최소 권한 정책을 생성하고 있습니다...</p>
            </div>

            <div id="readyToExecute" style="display: none;">
                <p style="font-size: 18px; font-weight: 500; margin-bottom: 8px;">실행 준비 완료</p>
                <p style="font-size: 14px; color: #6B7280; margin-bottom: 20px;">위 정책을 기반으로 보안 프로세스를 시작합니다.</p>
                <button class="btn btn-primary btn-lg" onclick="executeProcess()">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    실행하기
                </button>
            </div>
        </div>
    </div>
                <div id="executionSteps" class="hidden">
                    <div class="card" style="padding: 16px; margin-bottom: 16px;" id="stepsContainer">
                        <!-- Populated by JavaScript -->
                    </div>

                    <div class="alert alert-success hidden" id="executionComplete">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <div>
                            <p><strong>실행 완료:</strong> 모든 보안 프로세스가 성공적으로 완료되었습니다. 
                            임시 IAM 자격 증명은 안전하게 삭제되었으며, 모든 활동이 로깅되었습니다.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Logging -->

            
            <div class="step-content-wrapper" id="step-4">
    <div style="text-align: center; padding: 60px 20px;">
        <div style="margin-bottom: 24px;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z" fill="#16A34A"/>
            </svg>
        </div>

        <h2 class="section-title" style="font-size: 24px;">서비스 신청이 완료되었습니다</h2>
        <p class="section-description" style="font-size: 16px; margin-top: 12px;">
            모든 보안 검증 및 인프라 구성 작업이 성공적으로 끝났습니다.<br>
            <strong>콘솔을 통해 실행 결과를 확인해주세요.</strong>
        </p>

        <div style="margin-top: 48px; border-top: 1px solid #E5E7EB; padding-top: 40px;">
            <p style="font-size: 14px; color: #6B7280; margin-bottom: 16px;">다른 인프라를 추가로 구성하시겠습니까?</p>
                <button class="btn btn-primary btn-lg" onclick="resetAll()" style="padding: 12px 32px;">
                    <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 8px;">
                        <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                    새로 시작하기
                </button>
        </div>
    </div>
</div>
        </div>

        <!-- Navigation Buttons -->
        <div class="navigation">
            <button class="btn btn-secondary btn-lg" id="prevBtn" onclick="previousStep()">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
                이전
            </button>
            <button class="btn btn-primary btn-lg" id="nextBtn" onclick="nextStep()">
                다음
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                </svg>
            </button>
        </div>
    </div>

    <script type="module" src="/static/js/main.js" defer></script>
</body>
</html>